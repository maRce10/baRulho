<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Find acoustic markers on test sound files — find_markers • baRulho</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="Find acoustic markers on test sound files — find_markers" />
<meta property="og:description" content="find_markers find acoustic markers on test (re-recorded) sound files using spectrographic cross-correlation." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">baRulho</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/baRulho.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/maRce10/baRulho/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Find acoustic markers on test sound files</h1>
    <small class="dont-index">Source: <a href='https://github.com/maRce10/baRulho/blob/master/R/find_markers.R'><code>R/find_markers.R</code></a></small>
    <div class="hidden name"><code>find_markers.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>find_markers</code> find acoustic markers on test (re-recorded) sound files using spectrographic cross-correlation.</p>
    </div>

    <pre class="usage"><span class='fu'>find_markers</span><span class='op'>(</span><span class='va'>X</span>, template.rows <span class='op'>=</span> <span class='cn'>NULL</span>, markers <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"start_marker"</span>, <span class='st'>"end_marker"</span><span class='op'>)</span>,
test.files <span class='op'>=</span> <span class='cn'>NULL</span>, path <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span><span class='op'>(</span><span class='st'>"sound.files.path"</span>, <span class='st'>"."</span><span class='op'>)</span>, pb <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span><span class='op'>(</span><span class='st'>"pb"</span>, <span class='cn'>TRUE</span><span class='op'>)</span>, 
cores <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span><span class='op'>(</span><span class='st'>"mc.cores"</span>, <span class='fl'>1</span><span class='op'>)</span>,<span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>X</th>
      <td><p>Object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code><a href='https://marce10.github.io/warbleR/reference/selection_table.html'>selection_table</a></code> from the warbleR package) with the reference to the sounds in the master sound file. Must contain the following columns: 1) "sound.files": name of the .wav files, 2) "selec": unique selection identifier (within a sound file), 3) "start": start time, 4) "end": end time of selections and 5) "sound.id": unique identifier for each of the annotated sounds in 'X'. The acoustic start and end markers (added by <code><a href='master_sound_file.html'>master_sound_file</a></code>) should be labeled as "start_marker" and "end_marker" respectively. The markers added by  Columns for 'top.freq', 'bottom.freq' and 'channel' are optional. Required.</p></td>
    </tr>
    <tr>
      <th>template.rows</th>
      <td><p>Numeric vector with the index of the rows from 'X' to be used as templates. DEPRECATED.</p></td>
    </tr>
    <tr>
      <th>markers</th>
      <td><p>Character vector with the name of the annotations (as in the column 'sound.id') to be used as templates for cross-correlation. Default is <code><a href='https://rdrr.io/r/base/c.html'>c("start_marker", "end_marker")</a></code>. Using more than one marker is recomended as the time difference between their position can be used to evaluate the precision of the detection (see 'Value' section).</p></td>
    </tr>
    <tr>
      <th>test.files</th>
      <td><p>Character vector of length 1 with the name(s) of the test (re-recorded) file(s) in which to search for the marker(s). If not supplied all sound files in 'path' are used instead.</p></td>
    </tr>
    <tr>
      <th>path</th>
      <td><p>Character string containing the directory path where test (re-recorded) sound files are found.</p></td>
    </tr>
    <tr>
      <th>pb</th>
      <td><p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>cores</th>
      <td><p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing).</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments to be passed to <code><a href='https://marce10.github.io/ohun/reference/template_correlator.html'>template_correlator</a></code> for setting cross-correlation parameters (e.g. 'wl', 'ovlp', etc).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A data frame with test file names, marker name, maximum cross-correlation score for each tamplate and the start and end where it was detected. If two or more markers are used the function computes an additional column, 'time.mismatch', that compares the time difference between the two templates in the test-files against that in the master sound file. In a perfect detection the value must be 0.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The function takes a master sound file's reference data ('X') and finds the position of acoustics markers ('markers' argument, included as selections in 'X') in the re-recorded sound files. This is used to align signals found in re-recorded sound files according to a master sound file referenced in 'X'. The position of the markers is determined as the highest spectrogram cross-correlation value for each marker using the functions <code><a href='https://marce10.github.io/ohun/reference/template_correlator.html'>template_correlator</a></code> and <code><a href='https://marce10.github.io/ohun/reference/template_detector.html'>template_detector</a></code>. <strong>Make sure the master sound file (that refered to in 'X') is found in the same folder than the re-recorded sound files</strong>. Take a look at the package vignette for information on how to incorporate this function into a sound degradation analysis workflow.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Araya-Salas, M. (2020). baRulho: baRulho: quantifying habitat-induced degradation of (animal) acoustic signals in R. R package version 1.0.2</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='realign_test_sounds.html'>realign_test_sounds</a></code>; <code><a href='align_test_files.html'>align_test_files</a></code>; <code><a href='master_sound_file.html'>master_sound_file</a></code></p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Marcelo Araya-Salas (<a href='mailto:marcelo.araya@ucr.ac.cr'>marcelo.araya@ucr.ac.cr</a>)</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># use a temporary directory</span>
<span class='va'>td</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/tempfile.html'>tempdir</a></span><span class='op'>(</span><span class='op'>)</span>  

<span class='co'># load example data from warbleR</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span>list <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Phae.long1"</span>, <span class='st'>"Phae.long2"</span>, <span class='st'>"lbh_selec_table"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># save sound files to temporary folder</span>
<span class='fu'>writeWave</span><span class='op'>(</span><span class='va'>Phae.long1</span>, <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>td</span>, <span class='st'>"Phae.long1.wav"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'>writeWave</span><span class='op'>(</span><span class='va'>Phae.long2</span>, <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>td</span>, <span class='st'>"Phae.long2.wav"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># make an extended selection table</span>
<span class='va'>est</span> <span class='op'>&lt;-</span> <span class='fu'>selection_table</span><span class='op'>(</span>X <span class='op'>=</span> <span class='va'>lbh_selec_table</span>, extended <span class='op'>=</span> <span class='cn'>TRUE</span>, confirm.extended <span class='op'>=</span> <span class='cn'>FALSE</span>, 
path <span class='op'>=</span> <span class='va'>td</span>, pb <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='co'># create master sound file</span>
<span class='va'>master.sf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='master_sound_file.html'>master_sound_file</a></span><span class='op'>(</span>X <span class='op'>=</span> <span class='va'>est</span>, file.name <span class='op'>=</span> <span class='st'>"example_master"</span>, 
dest.path <span class='op'>=</span> <span class='va'>td</span>, gap.duration <span class='op'>=</span> <span class='fl'>0.3</span><span class='op'>)</span>

<span class='co'># read master</span>
<span class='va'>exmp.master</span> <span class='op'>&lt;-</span> <span class='fu'>readWave</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>td</span>, <span class='st'>"example_master.wav"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># add 1 s silence</span>
<span class='va'>exmp.test1</span> <span class='op'>&lt;-</span> <span class='fu'>addsilw</span><span class='op'>(</span>wave <span class='op'>=</span> <span class='va'>exmp.master</span>, at <span class='op'>=</span> <span class='st'>"start"</span>, d <span class='op'>=</span> <span class='fl'>1</span>,
output <span class='op'>=</span> <span class='st'>"Wave"</span>, f <span class='op'>=</span> <span class='va'>exmp.master</span><span class='op'>@</span><span class='va'>samp.rate</span><span class='op'>)</span>

<span class='va'>exmp.test2</span> <span class='op'>&lt;-</span> <span class='fu'>addsilw</span><span class='op'>(</span>wave <span class='op'>=</span> <span class='va'>exmp.master</span>, at <span class='op'>=</span> <span class='st'>"start"</span>, d <span class='op'>=</span> <span class='fl'>2</span>, 
output <span class='op'>=</span> <span class='st'>"Wave"</span>, f <span class='op'>=</span> <span class='va'>exmp.master</span><span class='op'>@</span><span class='va'>samp.rate</span><span class='op'>)</span>

<span class='co'># create noise</span>
<span class='va'>ns</span> <span class='op'>&lt;-</span> <span class='fu'>noisew</span><span class='op'>(</span>f <span class='op'>=</span> <span class='va'>exmp.master</span><span class='op'>@</span><span class='va'>samp.rate</span>, d <span class='op'>=</span> <span class='fu'>duration</span><span class='op'>(</span><span class='va'>exmp.test2</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>1</span>, 
output <span class='op'>=</span> <span class='st'>"Wave"</span><span class='op'>)</span>

<span class='co'># make noise exactly the same length and add noise to 2 examples</span>
<span class='va'>exmp.test1</span><span class='op'>@</span><span class='va'>left</span> <span class='op'>&lt;-</span> <span class='va'>exmp.test1</span><span class='op'>@</span><span class='va'>left</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>ns</span><span class='op'>@</span><span class='va'>left</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>exmp.test1</span><span class='op'>@</span><span class='va'>left</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>*</span> <span class='fl'>500</span><span class='op'>)</span>
<span class='va'>exmp.test2</span><span class='op'>@</span><span class='va'>left</span> <span class='op'>&lt;-</span> <span class='va'>exmp.test2</span><span class='op'>@</span><span class='va'>left</span> <span class='op'>+</span> <span class='op'>(</span><span class='va'>ns</span><span class='op'>@</span><span class='va'>left</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>exmp.test2</span><span class='op'>@</span><span class='va'>left</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>*</span> <span class='fl'>500</span><span class='op'>)</span>

<span class='va'>exmp.test1</span> <span class='op'>&lt;-</span> <span class='fu'>tuneR</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/tuneR/man/normalize.html'>normalize</a></span><span class='op'>(</span><span class='va'>exmp.test1</span>, unit <span class='op'>=</span> <span class='st'>"16"</span><span class='op'>)</span>
<span class='va'>exmp.test2</span> <span class='op'>&lt;-</span> <span class='fu'>tuneR</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/tuneR/man/normalize.html'>normalize</a></span><span class='op'>(</span><span class='va'>exmp.test2</span>, unit <span class='op'>=</span> <span class='st'>"16"</span><span class='op'>)</span>

<span class='co'># save examples</span>
<span class='fu'>writeWave</span><span class='op'>(</span>object <span class='op'>=</span> <span class='va'>exmp.test1</span>, filename <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>td</span>, <span class='st'>"example_test1.wav"</span><span class='op'>)</span>, extensible <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='fu'>writeWave</span><span class='op'>(</span>object <span class='op'>=</span> <span class='va'>exmp.test2</span>, filename <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='va'>td</span>, <span class='st'>"example_test2.wav"</span><span class='op'>)</span>, extensible <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='co'># search using start marker as template</span>
<span class='fu'>find_markers</span><span class='op'>(</span>X <span class='op'>=</span> <span class='va'>master.sf</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>master.sf</span><span class='op'>$</span><span class='va'>orig.sound.file</span> <span class='op'>==</span> <span class='st'>"start_marker"</span><span class='op'>)</span>,<span class='op'>]</span>,
test.files <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"example_test1.wav"</span>, <span class='st'>"example_test2.wav"</span><span class='op'>)</span>, path <span class='op'>=</span> <span class='va'>td</span>, pb <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='co'># search using end marker as template</span>
<span class='fu'>find_markers</span><span class='op'>(</span>X <span class='op'>=</span> <span class='va'>master.sf</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>master.sf</span><span class='op'>$</span><span class='va'>orig.sound.file</span> <span class='op'>==</span> <span class='st'>"end_marker"</span><span class='op'>)</span>,<span class='op'>]</span>, 
test.files <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"example_test1.wav"</span>, <span class='st'>"example_test2.wav"</span><span class='op'>)</span>, 
path <span class='op'>=</span> <span class='va'>td</span>, pb <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='co'># search using both start and end markers as template</span>
<span class='fu'>find_markers</span><span class='op'>(</span>X <span class='op'>=</span> <span class='va'>master.sf</span>, 
template.rows <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>master.sf</span><span class='op'>$</span><span class='va'>orig.sound.file</span> <span class='op'>==</span> <span class='st'>"start_marker"</span> <span class='op'>|</span> 
<span class='va'>master.sf</span><span class='op'>$</span><span class='va'>orig.sound.file</span> <span class='op'>==</span> <span class='st'>"end_marker"</span><span class='op'>)</span>, 
test.files <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"example_test1.wav"</span>, <span class='st'>"example_test2.wav"</span><span class='op'>)</span>, 
path <span class='op'>=</span> <span class='va'>td</span>, pb <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Marcelo Araya-Salas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


